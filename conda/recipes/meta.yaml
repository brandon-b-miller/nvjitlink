package:
  name: nvjitlink
  version: 0.1.0

source:
  #url: https://github.com/rapidsai/nvjitlink/archive/refs/tags/0.1.0.tar.gz
  path: ../../

build:
  noarch: python
  script:
    - export CMAKE_PREFIX_PATH=${PREFIX}/targets/x86_64-linux/lib:$CMAKE_PREFIX_PATH
    - pip install . -vv

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ compiler('cuda') }}
    - cmake >=3.26.4
    - sysroot_{{ target_platform }} 2.17
    - cuda-version =12.0
  host:
    - libnvjitlink-dev
    - libnvjitlink-static
    - cuda-version =12.0
    - python
    - scikit-build-core
  run:
    - python
    - numba >=0.57
#test:
#  imports:
#    - nvjitlink
#  source_files:
#    - nvjitlink/tests/test_nvjitlink_api.py
#    - nvjitlink/tests/test_nvjitlink.py
#    - nvjitlink/tests/test_device_functions.cubin
#    - nvjitlink/tests/test_device_functions.fatbin
#    - nvjitlink/tests/undefined_extern.cubin
#    
#
#  requires:
#    - pytest
#  commands: 
#    - pytest -v

about:
  home: https://github.com/rapidsai/nvjitlink
